## Hellointerview link :

## File Fingerprinting and Deduplication in Dropbox-like Systems

A file storage system like Dropbox uses hashing techniques to generate a unique fingerprint for each file, which helps prevent duplicate uploads and enables efficient storage. Here’s a high-level overview:

### 1. What is File Fingerprinting?

A file fingerprint is a unique identifier (like a digital signature) for a file, generated by processing its contents through a hash function. If two files have the same fingerprint, they are (with very high probability) identical.

### 2. Hashing Techniques Used

- **Cryptographic Hash Functions:**
  - Commonly used: **SHA-256** (most common), **SHA-1**, or **MD5** (less common now).
  - These functions take the file’s bytes and produce a fixed-size hash (e.g., 256 bits for SHA-256).
  - Even a tiny change in the file will produce a completely different hash.
- **Chunk-based Hashing (Content-Defined Chunking):**
  - Large files are split into smaller chunks (e.g., 4MB each).
  - Each chunk is hashed separately.
  - This allows for deduplication of parts of files (e.g., if you edit a document, only the changed chunks need to be uploaded).
- **Rolling Hashes:**
  - Used for chunk boundary detection (e.g., Rabin-Karp).
  - Helps in identifying similar regions even if content shifts (useful for versioning).

### 3. Overall Fingerprinting Flow During File Upload

1. **User Initiates Upload:** The client (user’s device) selects a file to upload.
2. **Client-side Hashing (Optional):** The client may compute the hash of the file or its chunks before uploading, saving bandwidth if the file already exists on the server.
3. **Server-side Hashing:** The server receives the file (or its chunks) and computes the hash (fingerprint) for the entire file or for each chunk.
4. **Duplicate Check:** The server checks its database for existing files/chunks with the same hash. If a match is found, the server can skip storing the duplicate data and only update metadata (e.g., “user X owns file Y”).
5. **Storing Data:** If the file/chunk is new, it is stored and its hash is recorded. If it’s a duplicate, only references are updated.
6. **Return File ID:** The server returns a file ID (often the hash itself or a database ID) to the client.

### 4. Benefits

- **Deduplication:** Saves storage by not storing the same file/chunk multiple times.
- **Efficiency:** Faster uploads for files already present (instant upload).
- **Integrity:** Hashes can be used to verify file integrity during transfer.

### 5. Example: Dropbox’s Approach

Dropbox uses a combination of:

- **SHA-256** for chunk and file fingerprinting.
- **Content-defined chunking** to split files.
- **Deduplication** at the chunk level.

#### Summary Table

| Step                | Technique Used       | Purpose                   |
| ------------------- | -------------------- | ------------------------- |
| Chunking            | Content-defined      | Efficient deduplication   |
| Hashing             | SHA-256 (or similar) | Unique fingerprint        |
| Duplicate Detection | Hash lookup          | Prevent duplicate storage |
| Integrity Check     | Hash comparison      | Ensure data not corrupted |

## Multi-part and Resumable Uploads: S3 MultiPart, TUS Protocol, and Dropbox-like Systems

Modern file storage systems support multi-part and resumable uploads to handle large files, unreliable networks, and to improve user experience. Here’s a gentle high-level overview:

### 1. Why Multi-part and Resumable Uploads?

- **Large Files:** Uploading huge files in a single request is unreliable and inefficient.
- **Network Issues:** If a connection drops, you don’t want to start over.
- **Parallelism:** Uploading parts in parallel speeds up the process.
- **Pause/Resume:** Users can pause and resume uploads without losing progress.

---

### 2. S3 MultiPart Upload (Amazon S3)

- **How it Works:**
  1. **Initiate Upload:** Client requests to start a multi-part upload; server returns an upload ID.
  2. **Upload Parts:** Client splits the file into parts (e.g., 5MB each) and uploads each part with the upload ID and part number. Parts can be uploaded in parallel and in any order.
  3. **Complete Upload:** After all parts are uploaded, client sends a complete request. S3 assembles the parts into the final file.
  4. **Abort Upload:** If needed, the upload can be aborted and incomplete parts are discarded.
- **Benefits:**
  - Resume failed uploads by re-uploading only failed parts.
  - Efficient for large files and unreliable networks.
  - Parallel uploads for speed.

---

### 3. TUS Protocol (Open Source Resumable Uploads)

- **What is TUS?**
  - An open protocol for resumable file uploads, supported by many cloud and self-hosted storage solutions.
- **How it Works:**
  1. **Create Upload:** Client requests a new upload; server responds with a unique upload URL.
  2. **Upload Chunks:** Client uploads file data in chunks (can be any size), using PATCH requests to the upload URL. Each chunk includes an offset.
  3. **Resume:** If interrupted, client queries the server for the current offset and resumes from there.
  4. **Finish:** When all data is uploaded, the server finalizes the file.
- **Benefits:**
  - Works over HTTP/HTTPS.
  - Supports pause, resume, and recovery from network failures.
  - Open standard, easy to integrate.

---

### 4. Dropbox-like Systems

- Dropbox and similar services use similar principles:
  - **Chunked Uploads:** Files are split into chunks, which are uploaded independently.
  - **Session Management:** Each upload session tracks progress and offsets.
  - **Resumability:** If an upload is interrupted, only missing chunks are re-uploaded.
  - **Finalization:** Once all chunks are uploaded, the server assembles the file.

---

### 5. Summary Table

| Feature         | S3 MultiPart      | TUS Protocol        | Dropbox-like Systems |
| --------------- | ----------------- | ------------------- | -------------------- |
| Chunked Upload  | Yes               | Yes                 | Yes                  |
| Parallel Upload | Yes               | Yes (client-driven) | Yes                  |
| Pause/Resume    | Yes               | Yes                 | Yes                  |
| Open Standard   | No (AWS-specific) | Yes                 | No                   |
| HTTP-based      | Yes               | Yes                 | Yes                  |
| Session Mgmt    | Upload ID         | Upload URL          | Session Token/ID     |

---

**In summary:** Multi-part and resumable uploads are essential for modern file storage, enabling reliable, efficient, and user-friendly handling of large files. S3 MultiPart and TUS are two popular approaches, and Dropbox-like systems use similar techniques under the hood.
